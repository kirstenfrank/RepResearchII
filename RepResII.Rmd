---
title: "Health and Economic Impacts of Storms"
author: "Kirsten Frank"
date: "October 22, 2014"
output: html_document
---
# Health and Economic Impact of Storms

## Synopsis
The US gets many storms a year. Data from the NWS (National Weather Service) was used to analyse the health effects and economic impact of storms. In particular, the storm type with a record of greatest loss of life and the type with a record of greatest economic damage were identified. {This Type} had greatest loss of life and {that type} had greatest economic damage. 

## Data processing

Data were downloaded from the course website (https://d396qusza40orc.cloudfront.net/repdata/data/StormData.csv.bz2), which got the data from 

```{r read in data and convert dates}
URL<-"https://d396qusza40orc.cloudfront.net/repdata/data/StormData.csv.bz2"
download.file(URL,destfile="compressed.bz2",method="curl")
StormData<-read.csv(bzfile("compressed.bz2"))
## Begin dates
StormData$BGN_DATE<-gsub("^([0-9])/","0\\1/",StormData$BGN_DATE,perl=TRUE)
StormData$BGN_DATE<-gsub("/([0-9])/","/0\\1/",StormData$BGN_DATE,perl=TRUE)
require(lubridate,quietly=TRUE)
StormData$BGN_DATE<-substr(as.character(StormData$BGN_DATE),1,10)
StormData$BGN_DATE<-mdy(StormData$BGN_DATE)
StormData$year<-year(StormData$BGN_DATE)
## End dates
StormData$END_DATE<-gsub("^([0-9])/","0\\1/",StormData$END_DATE,perl=TRUE)
StormData$END_DATE<-gsub("/([0-9])/","/0\\1/",StormData$END_DATE,perl=TRUE)
StormData$END_DATE<-substr(as.character(StormData$END_DATE),1,10)
StormData$END_DATE<-mdy(StormData$END_DATE)
## Ignore time, two different formats and lots missing.
```

## Exploratory Data Analysis
The notes in the variables file explain that the data is likely to be incomplete in the early years. We do some exploratory analysis to see how this affects our two variables of most interest, economic effects and loss of life.

```{r exploratory analysis}
require(dplyr)
StormData_date<-group_by(StormData,year)
#deaths
StormData_year_death<-summarize(StormData_date, sum(FATALITIES))
names(StormData_year_death)<-c("year","deaths")
plot(StormData_year_death$year,StormData_year_death$deaths)
#injuries
StormData_year_injury<-summarize(StormData_date, sum(INJURIES))
names(StormData_year_injury)<-c("year","injuries")
plot(StormData_year_injury$year,StormData_year_injury$injuries)
#cost
StormData_year_cost<-summarize(StormData_date, sum(PROPDMG))
names(StormData_year_cost)<-c("year","cost")
plot(StormData_year_cost$year,StormData_year_cost$cost)
```

There is a big jump in costs in `r min(StormData_year_cost$year[StormData_year_cost$cost>=3e+5])`. The fatalities also show a jump and stay higher around that time. Injuries don't seem to show a pattern overall with time. 

To explore this further, we examine the correlation between cost and fatalities and the correlation between cost and injuries.

```{r correlate cost injury and death by year}
StormData_year<-merge(StormData_year_cost, StormData_year_death, by = "year")
StormData_year<-merge(StormData_year, StormData_year_injury, by = "year")
cor_inj_cost<-cor(StormData_year$injuries,StormData_year$cost)
cor_death_cost<-cor(StormData_year$deaths,StormData_year$cost)
if(cor_inj_cost>cor_death_cost) {
    text_bigger<-"injury and cost"
    text_smaller<-"death and cost"
    } else {
    text_bigger<-"death and cost"
    text_smaller<-"injury and cost"
    }
```

The correlation is higher between `r print(text_bigger)` than `r print(text_smaller)`.

With the information of a great jump in both costs and fatalities in 1993, we are going to only use the years from 1993 to 2011. The assumption is that values are missing from the earlier years that are skewing the totals smaller. 
